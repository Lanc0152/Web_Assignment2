<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" /> <title>Assignment 2: Bouncer Game</title>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script async src="https://ga.jspm.io/npm:es-module-shims@1.7.0/dist/es-module-shims.js"></script>
        <script type="importmap"> {
            "imports": {
                "react": "https://esm.sh/react?dev",
                "react-dom/client": "https://esm.sh/react-dom/client?dev"
            }                    
        }
        </script>
    </head>
    <body>
        <div id="root"></div>
        <script type="text/babel" data-type="module" >
        import React, { useEffect, useState, StrictMode, useRef } from 'react';
        import { createRoot } from 'react-dom/client';

function MyApp() {
    const [bouncers, setBouncers] = useState([]);
    const [selected, setSelected] = useState(null);
    const [newBouncer, setNewBouncer] = useState({ x: 0, y: 0, width: 50, height: 50 });
    const [showForm, setShowForm] = useState(false);

    useEffect(() => {
        async function fetchBouncers() {
            let response = await fetch("http://localhost:8080/bouncer-sn041068644/resources/cst8218.sn041068644.bouncer.entity.bouncer");
            let data = await response.json();
            setBouncers(data);
        }
        
        fetchBouncers();
        const interval = setInterval(fetchBouncers, 1000); // Auto-refresh
        return () => clearInterval(interval);
    }, []);

    const handleInputChange = (event, index, field) => {
        const updatedBouncers = [...bouncers];
        updatedBouncers[index] = { ...updatedBouncers[index], [field]: event.target.value };
        setBouncers(updatedBouncers);
    };

    const handleUpdate = async (id, updatedBouncer) => {
        await fetch(`http://localhost:8080/bouncer-sn041068644/resources/cst8218.sn041068644.bouncer.entity.bouncer/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updatedBouncer)
        });
    };

    const handleDelete = async (id) => {
        await fetch(`http://localhost:8080/bouncer-sn041068644/resources/cst8218.sn041068644.bouncer.entity.bouncer/${id}`, { method: 'DELETE' });
        setBouncers(bouncers.filter(b => b.id !== id));
    };
    
    const handleFormChange = (event) => {
        setNewBouncer({ ...newBouncer, [event.target.name]: Number(event.target.value) });
    }

    const handleAddBouncer = async () => {
        //const newBouncer = { x: 0, y: 0, width: 50, height: 50 };
        let response = await fetch("http://localhost:8080/bouncer-sn041068644/resources/cst8218.sn041068644.bouncer.entity.bouncer", {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newBouncer)
        });
        let addedBouncer = await response.json();
        setBouncers([...bouncers, addedBouncer]);
        setShowForm(false);
        const newBouncer = { x: 0, y: 0, width: 50, height: 50 };
    };

    return (
        <div>
            <h2>Bouncer List</h2>
            <button onClick={() => setShowForm(true)}>Add New Bouncer</button>

            {showForm && (
                <div>
                    <h3>New Bouncer Details</h3>
                    <label>X: <input type="number" name="x" value={newBouncer.x} onChange={handleFormChange} /></label>
                    <label>Y: <input type="number" name="y" value={newBouncer.y} onChange={handleFormChange} /></label>
                    <label>Width: <input type="number" name="width" value={newBouncer.width} onChange={handleFormChange} /></label>
                    <label>Height: <input type="number" name="height" value={newBouncer.height} onChange={handleFormChange} /></label>
                    <button onClick={handleAddBouncer}>Submit</button>
                    <button onClick={() => setShowForm(false)}>Cancel</button>
                </div>
            )}
    
            <table border="1">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>X</th>
                        <th>Y</th>
                        <th>Width</th>
                        <th>Height</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {bouncers.map((bouncer, index) => (
                        <tr key={bouncer.id}>
                            <td>{bouncer.id}</td>
                            <td><input type="number" value={bouncer.x} onChange={(e) => handleInputChange(e, index, 'x')} /></td>
                            <td><input type="number" value={bouncer.y} onChange={(e) => handleInputChange(e, index, 'y')} /></td>
                            <td><input type="number" value={bouncer.width} onChange={(e) => handleInputChange(e, index, 'width')} /></td>
                            <td><input type="number" value={bouncer.height} onChange={(e) => handleInputChange(e, index, 'height')} /></td>
                            <td>
                                <button onClick={() => handleUpdate(bouncer.id, bouncer)}>Update</button>
                                <button onClick={() => handleDelete(bouncer.id)}>Delete</button>
                            </td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
    );
}

const container = document.getElementById('root');
const root = createRoot(container);
root.render(<MyApp />);

        </script>
    </body>
</html>

